# 基于社交网络的相似账户聚类方法

社交媒体上用户的信息主要包括用户的属性信息（比如地域、教育、职业、兴趣等），用户的互动行为信息（比如原创、转发、评论、分享等）；另一类是基于关注或者好友数据构建的社交网络。基于这种社交网络，微博中很多用户在微博中形成了类似于现实社会的社交圈子，这类社交圈子有一个共性就是在相同社交圈内粉丝重合度较高。相似账户聚类方法正是分析社交圈内粉丝数据来度量账户之间的相似性， 通过账户相似性来对微博中形成的社交圈进行归纳分类。

### 业务逻辑
基于社交关系的相似账户聚类方法是通过提取一批带类别标签的用户作为种子用户，计算其他用户与种子用户的相似性，将相似度高的用户划分到种子用户所在的类别。主要可以分为三步：种子用户选取；用户相似性计算；相似用户聚类。

##### 种子用户选取
种子用户应具有该类别的代表性，所以我们采用微博热门分类中的数据，以一个月内用户在某个类别出现的天数作为该用户的频次，提取每个类别中出现频次较高的账户作为该类别的种子用户。

```
类别  uid     名称
法制 1314608344 新闻晨报
国际 1733879143 北美新浪
科技 2476894617 IT观察猿
科普 2206258462 NASA中文
数码 2824626113 IT科技侠
财经 1642088277 财经网
股市 1690076015 熊市猎人
明星 1831216671 黄磊微博
综艺 1713458220 非诚勿扰
电视剧 3986147355 新剧不能停
电影 3125368791 我的电影圈
音乐 2302150931 欧美流行乐
汽车 1757600001 全球汽车搜罗
体育 2432009827 篮球大图
... 
```

##### 用户相似性计算
用户相似性的计算方法是通过基于用户的协同过滤的方法，以用户的粉丝数据作为用户的特征构建用户粉丝特征向量，通过计算账户特征向量之间的余弦值作为其相似性的度量。其中用户相似度定义为：

\\(fanssim_{st} = \cos(fans_s, fans_t)= \frac{fans_s * fans_t }{\sqrt{|fans_s | * | fans_t |}}=\frac{fansnum_{st}}{\sqrt{fansnum_s*fansnum_t}}\\)

\\(fans_s, fans_t\\)分别表示用户s和用户t的粉丝向量；
\\(fansnum_s, fansnum_t\\)分别表示用户s和用户t的粉丝向量数；
\\(fansnum_{st}\\)表示用户s和用户t的共有粉丝数；

由于数据量巨大，以下方法都通过mapreduce方式实现
（1）数据准备：该计算基于关注数据集，其数据在Hdfs中保存方式为：

```
    fans_uid （Long） : 粉丝账户id 
    uid  (Long): 被关注人账户id
    time (timestamp)： 时间
```

（1.1）优质用户集获取
    该模块提取微博用户集中发微博的平均阅读数在5万以上的用户作为优质用户。
（1.2）获取用户粉丝数
    该模块的计算通过一个Hadoop job实现。 基于关注数据集通过布隆过滤器的方法过滤非种子用户集和优质用户集的数据，提取出种子用户集和优质用户集的粉丝列表，并计算其粉丝数。数据保存格式为:
{uid(Long),  fansnum(int)}

（2）计算账户相似度
（2.1）计算共有粉丝数
    该模块的计算通过两个Hadoop job实现。
    Job1: 通过建立两个布隆过滤器来保存优质用户集和种子用户集， 由于用户账号属于Long 数据类型可以用8个byte来描述， 我们建立一个9个byte的数据（定义为follow）。用前8个byte存储用户账号，最后一个byte用来标识该账号属于优质用户集还是种子用户集。遍历关注数据集，提取出粉丝的关注列表。该关注列表中只包含属于优质用户集和种子用户集的账号。数据保存格式为：
{uid(Long), follow1|follow2|…|followN}
其中uid为粉丝账户id。
    job2：通过分析job1的粉丝关注列表，提取出优质用户集和种子用户集中各账号之间共有的粉丝列表，并统计共有粉丝数。数据保存格式为：
{key, number(int)}
其中key为16个byte的数据，前8个byte和后8个byte分别存储账户id。number为共有粉丝数

（2.2）计算相似度并排序
    该模块的计算通过一个Hadoop job实现，基于优质用户粉丝数，种子用户粉丝数和其共有粉丝数数据， 我们根据余弦定理的相似度计算方法，计算得到优质用户集中每个账户与种子用户的相似性。

##### 相似用户标签分类
根据种子用户集与优质用户集中用户之间的相似性，我们对优质用户集中的每个用户选择种子用户集中与其相似度值最大的标签作为其的分类标签。

### 效果分析

我们对分类后的数据进行处理，并取的其相应账户的名称作为辅助数据，对分类结果进行以下分析。

- 如效果数据1，我们从数据中提取一部分类别中相似度较高的前12个账户的信息。大体上，从用户的名称上看，分类基本准确。
- 我们随机抽取100个账户对其分类结果进行分析，通过直观判断其分类的准确性。如效果数据2，分类的准确度在77%左右。
- 我们提取相似度的top100的账户分类结果进行分析，通过直观判断其分类的准确性。如效果数据3，分类的准确度在90%左右。


效果数据1

```
舞蹈 6085757627(外国舞蹈秀) 6041830461(日本舞蹈大全)---->6090644791(这些舞蹈必须看)---->6179910504(Dancer舞步)---->5990887561(BodyRock君君)---->6042105362(popping舞吧)---->6041830455(今天我们看舞蹈)---->5990887560(Oral爱跳舞)---->6042105395(皇帝说史)---->2122216355(我们都爱舞蹈)---->3083678454(微博舞蹈)---->1238141300(闻松V)---->2260684402(老铁随笔)---->6085757559(搞笑cut菌)

美食 5181464632(365道美食DIY) 5222794628(舌尖上地菜谱)---->5205919794(热门美食精选)---->3954698413(热美食)---->3986933335(美食天天见)---->2140227493(天天美食推荐)---->2142168143(全球健身中心)---->5608766991(健身老师课)---->3694919990(各国美食学起来YOU)---->1992523932(美食工场)---->6041830356(煮妇志)---->2697416452(999道私房菜)---->1705180884(陈欧)---->3948713134(日食记)

情感 2757639945(毒鸡汤公举) 2313503303(那些经典情感故事)---->1130677950(老男孩情感语录)---->2619130163(芒果萌小妞)---->2690072103(一句情感语录)---->1749975705(唯美式情感语录)---->2712118811(致前任的情书)---->2589432731(桥话)---->2453478394(女人情感深处)---->2799770923(热门情感心语)---->2737131784(爱情日志)---->2693029692(女人情感营)---->2041668063(娱乐圈头条榜)---->3167374242(娱乐圈扒娘娘)

家具 2543858012(小户型装修设计小窝) 5945228496(家居设计收纳学)---->3192225032(暖小居)---->3948487233(中式装修家居设计)---->3610784645(整体家装设计师)---->2725161337(小户型家居设计)---->2475850591(装修魔方)---->1679302152(创意家居装修设计)---->5745465827(小户型装修罗曼史)---->2165286784(家居装修创意设计)---->5948336939(热门家装)---->1897320685(DIY设计我的家)---->1780801967(idc室内设计与装修)---->1604533457(家居装修效果图室内装修设计图片)

体育 2432009827(篮球大图) 3166016577(FREEHDNBA)---->2670184211(篮球大片)---->1990309453(皇马新闻)---->1718966023(科比吧官方微博)---->2418842335(巴萨推特)---->2746296141(张国伟_国家伟大)---->1666330110(朱彥碩)---->3421165650(TheBeckhams)---->1990954515(切尔西新闻)---->2809841193(ManUtdspot)---->1901333207(篮天下Dime)---->1805968627(篮球系)---->6185411519(NBA篮球动态)

校园 1750067330(高考直通车) 1642629063(高考快讯)---->2031081281(高考作文素材大全)---->2969814570(高考英语资料)---->1630214397(高考文科)---->2969811004(高考语文资料)---->3314408752(高考励志集)---->2012565615(广东高考快讯)---->5091176621(高考数学资料)---->3232493521(高考政治资料)---->1630205674(高考理科)---->5596926888(全国大联考)---->1713926427(微博搞笑排行榜)---->3041266824(高考化学资料)

法律 1272651680(周泽律师) 1704084074(杨学林律师)---->1803570001(陈有西)---->1837869620(童之伟)---->1669764455(青石律师)---->1215031834(何兵)---->1672392695(None)---->1218098864(叶匡政)---->1233488674(王才亮律师)---->1776361441(许丹)---->1042940955(薛荣民)---->1830438495(土家野夫)---->1700757973(王克勤)---->1246219552(刘桂明)

军事 5939109236(军武菌) 1045269490(杜长军)---->5941687237(军武次位面)---->3775056661(巍岳钦禹)---->5941459143(航空君)---->5940474579(烽火议军情)---->2099591797(鍋盖頭司令)---->3939426052(地瓜熊老六)---->1433680664(paingod)---->1499104401(新浪军事)---->6014403348(草蜢一号)---->1823287210(SGT_SONG谈军事)---->1231317854(工业科技迷)---->5370547595(义勇军帝师)

萌宠 5454806466(汪星人日记) 2331621641(萌狗小百科)---->1676001761(喵星人星球)---->5041262490(酥饼大人)---->2508752764(全球萌宠中心)---->3803127031(可爱萌宠物中心)---->2470096410(萌猫小百科)---->5803280383(笛子的宣妍)---->2774852311(烧焦的五百万)---->5751956453(MOS咖啡霜减肥糖果)---->5685899643(表情专辑)---->3985189899(视频乌托邦)---->5101869894(扒圈星探)---->1660612723(可爱宠物中心)

......
```

效果数据2
    
```
动漫 2885013412(神棍一般的五叔)__1--->1654134123(早报网)__2--->1513412472(安西千岁)__1
汽车 2341494155(校花校草玩时尚)__2--->2841334182(爱美食爱生活的Kimmy)__2
法制 1934183965(微博管理员)__1--->1717833412(华商报)__1
科普 6209134117(纪录片大赏)__1--->1408329341(少個螺絲)__1
数码 2021498341(狄狄蜀黍)__1
搞笑 2799534160(段子PK秀)__1
游戏 6233413558(王者荣耀吐槽小队长)__1--->3550503413(主播耗子)__1--->2801341052(Q-LEE李幼恩)__1--->2263636341(陈大榕___)__1--->3341507382(土豪)__1
美妆 1834123670(Ma_Suki)__1--->5399034144(元气美图)__1--->6209134126(少女的闺房)__1
科技 1642634100(新浪科技)__1
音乐 2679053417(鬼牵牛)__1--->2658061341(刘小芹LIuuu)__1
时尚 6041830341(安妮时尚说)__1
婚庆 1291141341(LINMAKEUP化妆造型总监罗涛)__1
萌宠 3994341568(iPanda熊勒个猫)__1--->5034173124(美食曲线)__2--->3412281544(小编谈财经)__2--->5866386341(王者荣耀神段子)__1--->2453411002(猫狗萌星球)__1
法律 2553418722(劳丽诗)__1--->1677923413(叶克飞)__1--->1660276341(叶语Clarence)__1
佛教 2203416793(如瑞法师)__1--->1057734167(任芸丽)__1--->1634141547(一迹君)__1--->3740341004(高一清JACKAL)__1--->5501434177(livephoto壁纸大全)__2--->2110962341(yoyo酱的小木屋)__2--->1213327341(严屹宽)__1--->2483416723(法藏寺)__1--->5501341044(传媒娱乐实习生)__2
时装 2118588341(上海资讯热点)__1--->1769293417(都市丽人杂志)__1
美食 3341360070(Lans_Patisserie)__1--->5100341367(屌丝烘焙败家会所)__1--->5722634120(美食台foodvideo)__1
明星 1341614173(纪姿含)__1--->1264341240(晓敏_Jasmine)__1--->5634109015(潘绫莹)__1--->5341306507(郑容和89)__1--->6341651747(生活相对论官微)__2
体育 1913412967(足球周刊)__1
瘦身 5686734198(颖涵的快厨房)__1
政务 1829569341(徐莉佳)__1--->1513934187(新浪读书)__1
历史 5834198610(军人之家)__1
艺术 1767634132(秋天的亦然)__1--->5343419890(番茄青年实验室)__1--->1751341470(善良的sweetblood)__1
设计 1296341560(陆地上的海蛎子2011)__1
健康 1323417897(一代萌猫)__1--->6183821341(怪我笑的太逼真)__2--->6209134131(医院那些点事)__1
国际 5098053417(诗姐八美国政治)__1
综艺 2539323341(我想和你唱)__1--->1704518341(程野)__1--->1708763410(浙江日报)__2--->3363163410(红网)__1
模特 3239923412(Oddrfd)__1--->1273417854(小模样)__1--->2689634173(hitomiss星)__1
养生 3434191404(笑星视频)__1--->3414335312(Nuskin如新Emily)__1--->5451803419(英文教师)__2--->3603341852(wnex)__1--->2334112875(潘清照)__1
情感 1800341434(大学校长)__2--->3418457272(美妈潮流)__1--->1725655341(湘潭新鲜事)__1
三农 3153417412(蓝天白云飞翔888)__2--->1351341412(王若涵)__2--->5606834185(谈股论金--Phoenix)__2--->3123410581(幸运之神-阿兰贝尔)__2
财经 6280362341(锋味)__1--->3281973414(新浪陕西咸阳频道)__1--->1875034341(华尔街见闻APP)__1--->3341719334(汉中旅游)__2
摄影 2858965341(疯子Charles)__1--->1887341152(東來_ldldick)__1
军事 2126034191(文娱大事件)__2--->1648856341(妮籽)__2--->5765153417(流逝的青春-年华)__1
家具 3419305134(老夏和脆鹅)__1--->2473373410(Top-Fashion-Girls)__2--->5375834197(造屋梦想)__1--->1805734167(就要这样谈恋爱)__2
辟谣 3412845940(即墨法院)__2--->3416927232(艾菲_Ivy_)__1
育儿 1397634191(燕儿丫丫)__1--->3568341657(食神2千金Ma-红萍)__1
```
    
效果数据3

```
情感 2313503303(那些经典情感故事)__1--->1130677950(老男孩情感语录)__1--->2619130163(芒果萌小妞)__1--->2690072103(一句情感语录)__1--->1749975705(唯美式情感语录)__1--->2712118811(致前任的情书)__1
体育 3166016577(FREEHDNBA)__1--->2670184211(篮球大片)__1
财经 3116351471(乐购乐活派)__--->1930685963(51Give我要给予)__1--->1893821087(天极网华南)__1
摄影 3024769222(娱乐圈教授)__1--->2041668063(娱乐圈头条榜)__1--->1740334623(摄影之友)__1--->2998156335(世界美图)__1--->2250726962(顶尖摄影观赏)__1--->2127121307(全球摄影精选集)__1--->1674175865(图虫摄影网)__1--->1663232781(全景日记)__1--->2825653895(摄影约拍_)__1
历史 1045529987(雷颐)__1--->3669893730(作家邓海春)__1--->2606812875(历史课课代表)__1--->2141344675(None)__1--->2662423037(全球博物馆)__1
科普 1860128420(大脸撑在小胸)__1--->1763864272(中国气象爱好者)__1--->1200933465(江氏小盗龙)__1--->1642632622(科学探索)__1--->5097174964(科普君XueShu)__1--->1644225642(美国国家地理)__1--->1927070524(科学家种太阳)__1--->1835812695(超级实用小百科)__1--->1820201245(奥卡姆剃刀)__1--->5346801743(新语丝之光001)__1--->2611052107(社交礼仪心理学)__1
婚庆 2257780772(办婚礼的那点事)__1--->2290497005(最佳婚礼灵感)__1
法律 1704084074(杨学林律师)__1--->1803570001(陈有西)__1
佛教 5666892465(辣妈麦小奢)__2
军事 1416237723(默虹_美海军学习小站)__1--->1045269490(杜长军)__1--->5941687237(军武次位面)__1--->3775056661(巍岳钦禹)__1--->5941459143(航空君)__1--->5940474579(烽火议军情)__1--->3279710155(斯图卡98)__1--->2099591797(鍋盖頭司令)__1--->1499104401(新浪军事)__1--->5133215733(军粉)__1--->3939426052(地瓜熊老六)__1--->1433680664(paingod)__1
电视剧 5945493475(剧荒终结者)__1--->2535005327(剧探王)__1
健身 1344360230(Kevin凯文老师)__2--->1197161814(李开复)__2--->1249159055(苏芩)__1--->1816011541(张小娴)__1--->1223762662(林心如)__2--->1854283601(郭德纲)__2--->1087770692(陈坤)__1--->1291017722(赵文瑄)__1--->1708767015(叶祖新)__1--->1198920804(杨澜)__2
舞蹈 6041830461(日本舞蹈大全)__1--->6090644791(这些舞蹈必须看)__1--->6179910504(Dancer舞步)__1--->5990887561(BodyRock君君)__1--->6042105362(popping舞吧)__1--->6041830455(今天我们看舞蹈)__1
游戏 2879470994(WE_草莓丶)__1--->2495158142(WE_微笑)__1
时尚 5699800500(望穿秋裤的安珀汐)__1
健康 6164450686(微博健康医疗)__1--->3867884082(IsEE正品美瞳总代理丸子)__2--->2459896291(孟晗-RPM_tuning)__1--->1820315971(奢悦楠姐)__1--->3910706579(阿迪新百伦亚瑟士彪马鞋子代购)__2--->2633864702(盛发隆燕窝批发-蔡R)__1--->6111072823(洗纹身-专家)__1--->3783910663(Jenny中古屋)__1--->5943932342(塔罗牌占卜露娜)__2--->3114270171(南京无痕接发instyle廷磊主理人)__1--->1268642527(新浪健康)__1
汽车 1794993692(汽车也疯狂)__1--->1784830527(汽车全搜罗)__1--->1819208550(全球汽车潮流)__1
星座 1729781955(面相先生)__1--->1998243277(运势君)__1
校园 2100445057(老蒋政治-蒋中挺)__1--->1227078145(肖秀荣教授)__1--->1667434994(刘一男)__1
电影 2726883997(电影士)__1--->5727695436(粽子说)__1--->1846116411(国际在线娱乐)__1--->3558929181(美妆师carla)__2
时装 1223849864(风度mensuno)__1--->1248146160(温宇)__1--->1359179855(时装男士杂志)__1
```






